<html class="metro">
  <head>
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0" />

    <link rel="stylesheet" href="css/metro-bootstrap.min.css">
    <link rel="stylesheet" href="css/iconFont.min.css">


    <script src="js/jquery/jquery.min.js"></script>
    <script src="js/jquery/jquery-ui.min.js"></script>
    <!--<script src="js/jquery/jquery.widget.min.js"></script>-->
    <script src="js/metro.min.js"></script>
    <script src="js/metro-notify.js"></script>
    <script src="js/metro-dialog.js"></script>
    <style>
      html, body {font-size:12px;overflow: hidden;}
      .icon{width:120px;height:120px}
      #canvas
      {
        float:left;
        height:100%;
        width:60%
      }
      #scrollbox
      {
        height: 100%;
        width: 40%;
        background: #F5F5F5;
        overflow-y: scroll;
        overflow-x: visible;
        float:right;
      }
      #scrollbox::-webkit-scrollbar-track
      {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        background-color: #F5F5F5;
      }

      #scrollbox::-webkit-scrollbar
      {
        width: 10px;
        background-color: #F5F5F5;
      }

      #scrollbox::-webkit-scrollbar-thumb
      {
        background-color: #0ae;

        background-image: -webkit-gradient(linear, 0 0, 0 100%,
          color-stop(.5, rgba(255, 255, 255, .2)),
          color-stop(.5, transparent), to(transparent));
        }
      .list-content{text-align:left}
      .metro .listview-outlook .list:active{background-color: #F5F5F5}
      .notifyWrap{display: none}
    </style>
  </head>
  <body class="listview-outlook">
    <nav class="navigation-bar dark">
      <div class="navigation-bar-content">
        <button href="#" class="element"><span class="icon-grid-view"></span> Data harvest </button>
        <span class="element-divider"></span>
        <a class="pull-menu" href="#"></a>

        <div class="no-tablet-portrait">
          <button class="element brand" href="#"><span class="icon-printer"></span></button>
          <span class="element-divider"></span>

          <div class="element input-element">
            <form>
              <div class="input-control text">
                <input id="name" type="text" placeholder="Search...">
                <button class="btn-search"></button>
              </div>
            </form>
          </div>
          <div class="element">
            <table class="notifyWrap" style="height:100%;width:100%;background-color: rgba(0,0,0,0);padding:0;margin:0">
              <td style="text-align:center;vertical-align:center"><img src="img/loading.gif" width="16" height="16"></td>
              <td style="padding-left:10px"><span class="threadMessage" style="font-size:12px;color:#ccc"></span></td>
            </table>
          </div>
        </div>
      </div>
    </nav>
      <div id="scrollbox">
        <table class="notifyWrap" style="height:100%;width:100%;background-color: rgba(0,0,0,0);padding:0;margin:0">
          <td style="text-align:center;vertical-align:center"><img src="img/loading.gif" width="40" height="40"><br><br><span class="threadMessage" style="font-size:12px;color:#666"></span></td>
        </table>
      </div>
      <div id="canvas"></div>
    <script>

      /*

      Storage for results :

          - key must be unique
          - links for graph
          - valid for validation, but keep data

      */
      var storageResults = {};

      var currentObjToValidate = null;
      var searchString = "";

      $("#name").bind("keypress", {}, search);
      function search(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {

          e.preventDefault();
          searchString = $('#name').val();

          var query = {params: searchString, method: "googlePlusSearch", callback:"searchCallback", notify: "searchNotify"};
          pyBridge.runThread(JSON.stringify(query));

          $('#name').val("");
          $('.notifyWrap').css("display", "block");

        }
      }

      function searchNotify(results) { $(".threadMessage").html(results); }

      function searchCallback(results) {

        $('.notifyWrap').css("display", "none");

        for (var i in results) {

          // UI refresh
          var html = $('#scrollbox').html();

          var result = '<div data-id="' + results[i][1] + '" data-name="' + results[i][0] + '" class="list" onclick="selection($(this))"><div class="list-content"><img src="' + results[i][2] + '" class="icon">';
          result += '<div class="data"><span class="list-title">' + results[i][0] + '</span>';
          result += '<span class="list-subtitle">' + results[i][1] + '</span><span class="list-remark">Google Plus Account</div></div></div>';

          $('#scrollbox').html(html + result);

          // Storage results
          storageResults[results[i][1]] = {username: results[i][0], photo: results[i][2], links: {}, valid: false};

        }
        $("#console").html("");
        var note = $.Notify.show("Search done for " + searchString);
      }

      function selection (obj) {

        currentObjToValidate = obj;
        /*if (currentObjToValidate.hasClass("selected")) currentObjToValidate.toggleClass("selected");
        else {

          $.Dialog({

            overlay: true,
            shadow: false,
            flat: true,
            icon: '',
            title: 'Confirm identity : ' + obj.attr('data-name'),
            content: '',
            padding: 0,
            width: 500,
            sysButtons: false,
            onShow: function(_dialog) {

              var htmlContent = '<table style="width:100%" class="panel"><tr class="panel-header"></tr><tr>';
              htmlContent += '<td class="panel-content"><img src="' + obj.find("img").attr("src") + '" width="100" height="100"></td>';
              htmlContent += '</tr><tr><td><button href="#" class="button" onclick="testConnection(\'' + obj.attr("data-id") + '\')">Test connection</button></td><td>';
              htmlContent += '<button href="#" style="float:right" class="button" onclick="$.Dialog.close()">Cancel</button></td>';
              htmlContent += '<td><button href="#" class="button primary" onclick="validateIdentity()">Confirm</button></td></tr></table>';

              $.Dialog.content(htmlContent);
              $.Metro.initInputs();

            }
          });
        }*/
      }

      function validateIdentity() {

        currentObjToValidate.toggleClass("selected");
        $.Dialog.close();

      }

      function testConnection(target) {

        var query = {params: target, method: "googlePlusSearchFriends", callback:"searchFriendsCallback"};
        pyBridge.runThread(JSON.stringify(query));

      }

      function searchFriendsCallback(results) {

        alert(results);

      }

      $("#scrollbox").sortable({
        scroll: false,
        helper: function (e, div) {

          var cloned = div.clone();
          cloned.css("background-color", "#F5F5F5");
          return cloned;

        }
      }).disableSelection();

      $("#canvas").droppable({
        over: function(event, ui) {

        },
        drop: function(event, ui) {
          //var code = $(ui.helper).clone().wrap('<div>').parent().html();
          //alert(code);
        }
      });
    </script>
  </body>
</html>
