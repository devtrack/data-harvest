<html>
  <head>
    <link rel="stylesheet" href="css/metro-bootstrap.min.css">
    <link rel="stylesheet" href="css/iconFont.min.css">

    <script src="js/jquery/jquery.min.js"></script>
    <script src="js/jquery/jquery.widget.min.js"></script>
    <script src="js/metro.min.js"></script>
    <script src="js/metro-notify.js"></script>
    <script src="js/metro-dialog.js"></script>

    <style>
      body {font-size:12px}
      .icon{width:120px;height:120px}
      #scrollbox
      {
        float: left;
        height: 555px;
        width: 40%;
        background: #F5F5F5;
        overflow-y: scroll;
        float:right;
      }
      #scrollbox::-webkit-scrollbar-track
      {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        background-color: #F5F5F5;
      }

      #scrollbox::-webkit-scrollbar
      {
        width: 10px;
        background-color: #F5F5F5;
      }

      #scrollbox::-webkit-scrollbar-thumb
      {
        background-color: #0ae;

        background-image: -webkit-gradient(linear, 0 0, 0 100%,
          color-stop(.5, rgba(255, 255, 255, .2)),
          color-stop(.5, transparent), to(transparent));
        }
      .list-content{text-align:left}
    </style>
  </head>
  <body class="metro">
    <nav class="navigation-bar dark">
      <div class="navigation-bar-content">
        <button href="#" class="element"><span class="icon-grid-view"></span> Data harvest </button>
        <span class="element-divider"></span>
        <a class="pull-menu" href="#"></a>

        <div class="no-tablet-portrait">
          <button class="element brand" href="#"><span class="icon-printer"></span></button>
          <span class="element-divider"></span>

          <div class="element input-element">
            <form>
              <div class="input-control text">
                <input id="name" type="text" placeholder="Search...">
                <button class="btn-search"></button>
              </div>
            </form>
          </div>

          <div class="element place-right">
            <a class="dropdown-toggle" href="#">
              <span class="icon-cog"></span>
            </a>
            <ul class="dropdown-menu place-right" data-role="dropdown">
              <li><a href="#">Products</a></li>
              <li><a href="#">Download</a></li>
              <li><a href="#">Support</a></li>
              <li><a href="#">Buy Now</a></li>
            </ul>
          </div>
        </div>
      </div>
    </nav>
      <div class="scrollbar">
        <div id="scrollbox" class="listview-outlook"></div>
      </div>
    <script>

      /*

      Storage for results :

          - key must be unique
          - links for graph
          - valid for validation, but keep data

      */
      var storageResults = {};

      var currentObjToValidate = null;
      var searchString = "";

      $("#name").bind("keypress", {}, search);
      function search(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {

          e.preventDefault();
          searchString = $('#name').val();
          pyBridge.search(searchString);
          $('#name').val("");
          $("#scrollbox").html('<table style="height:555px;width:100%;background-color: #F5F5F5;"><td style="text-align:center;vertical-align:center"><img src="img/loading.gif" width="40" height="40"></td></table>')

        }
      }

      function searchCallback(results) {

        $('#scrollbox').html("");

        for (var i in results) {

          // UI refresh
          var html = $('#scrollbox').html();

          var result = '<div data-name="' + results[i][0] + '" class="list" onclick="selection($(this))"><div class="list-content"><img src="' + results[i][2] + '" class="icon">';
          result += '<div class="data"><span class="list-title">' + results[i][0] + '</span>';
          result += '<span class="list-subtitle">' + results[i][1] + '</span><span class="list-remark">Google Plus Account</div></div></div>';

          $('#scrollbox').html(html + result);

          // Storage results
          storageResults[results[i][1]] = {username: results[i][0], photo: results[i][2], links: {}, valid: false};

        }
        $("#console").html("");
        var note = $.Notify.show("Search done for " + searchString);
      }

      function selection (obj) {

        currentObjToValidate = obj;
        if (currentObjToValidate.hasClass("selected")) currentObjToValidate.toggleClass("selected");
        else {

          $.Dialog({

            overlay: true,
            shadow: false,
            flat: true,
            icon: '',
            title: 'Confirm identity : ' + obj.attr('data-name'),
            content: '',
            padding: 0,
            width: 500,
            sysButtons: false,
            onShow: function(_dialog) {

              var htmlContent = '<table style="width:100%" class="panel"><tr class="panel-header"></tr><tr>';
              htmlContent += '<td class="panel-content"><img src="' + obj.find("img").attr("src") + '" width="100" height="100"></td>';
              htmlContent += '</tr><tr><td style="vertical-align:bottom">';
              htmlContent += '<a href="#" class="button primary" onclick="validateIdentity()">Confirm</a></td>';
              htmlContent += '<td><a href="#" style="float:right" class="button" onclick="$.Dialog.close()">Cancel</a></td></tr></table>';

              $.Dialog.content(htmlContent);
              $.Metro.initInputs();

            }
          });
        }
      }

      function validateIdentity() {
        currentObjToValidate.toggleClass("selected");
        $.Dialog.close();
      }

    </script>
  </body>
</html>
